<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.candao.www.data.dao.TReturnDishDetailDao">

    <!-- 退菜明细表 -->
    <parameterMap type="map" id="homeVO">
        <parameter property="branchid" jdbcType="INTEGER" mode="IN"/>
        <parameter property="shiftid" jdbcType="INTEGER" mode="IN"/>
        <parameter property="beginTime" jdbcType="DATE" mode="IN"/>
        <parameter property="endTime" jdbcType="DATE" mode="IN"/>
        <parameter property="currPage" jdbcType="INTEGER" mode="IN"/>
        <parameter property="pageNums" jdbcType="INTEGER" mode="IN"/>
        <parameter property="result" jdbcType="VARCHAR" mode="OUT"/>
    </parameterMap>

    <select id="getReturnDishList" parameterMap="homeVO" statementType="CALLABLE" resultType="map">
        {call p_report_tcmxb(
        ?,?,?,?,?,?,?
        )}
    </select>
    <select id="getPresentDishList" parameterType="map" resultType="map">
        SELECT
        a.begintime AS beginTime,
        a.orderid,
        e.title,
        d.dishnum AS num,
        d.dishnum * d.orignalprice AS amount,
        c.name AS accreditWaiter,
        d.sperequire
        FROM t_order_detail d
        INNER JOIN t_order a
        ON d.orderid = a.orderid
        LEFT JOIN t_dish e
        ON d.dishid = e.dishid
        LEFT JOIN t_b_employee b
        ON a.userid = b.job_number
        LEFT JOIN t_b_user c
        ON b.user_id = c.id
        WHERE d.pricetype=1 AND a.orderstatus=3
        AND a.begintime BETWEEN #{beginTime} and #{endTime}
        <if test="shiftid!=-1">
            AND a.shiftid=#{shiftid}
        </if>
        ORDER BY a.begintime DESC
        limit ${offset},${pageNums}
    </select>
</mapper>