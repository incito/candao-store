<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.candao.www.data.dao.TReturnDishDetailDao">

    <!-- 退菜明细表 -->
    <parameterMap type="map" id="homeVO">
        <parameter property="branchid" jdbcType="INTEGER" mode="IN"/>
        <parameter property="shiftid" jdbcType="INTEGER" mode="IN"/>
        <parameter property="beginTime" jdbcType="DATE" mode="IN"/>
        <parameter property="endTime" jdbcType="DATE" mode="IN"/>
        <parameter property="currPage" jdbcType="INTEGER" mode="IN"/>
        <parameter property="pageNums" jdbcType="INTEGER" mode="IN"/>
        <parameter property="result" jdbcType="VARCHAR" mode="OUT"/>
    </parameterMap>

    <select id="getReturnDishList" parameterMap="homeVO" statementType="CALLABLE" resultType="map">
        {call p_report_tcmxb(
        ?,?,?,?,?,?,?
        )}
    </select>
    <select id="getPresentDishList" parameterType="map" resultType="map">
        SELECT
        a.begintime AS beginTime,
        a.orderid,
        e.title,
        d.dishnum AS num,
       convert( d.dishnum * d.orignalprice,DECIMAL (10,2)) AS amount,
        d.sperequire
        FROM t_order_detail d
        INNER JOIN t_order a
        ON d.orderid = a.orderid
        LEFT JOIN t_dish e
        ON d.dishid = e.dishid
        WHERE d.pricetype=1 AND a.orderstatus=3  AND ((d.ordertype=2 AND ismaster=1) OR d.ordertype&lt;&gt;2 )
        AND a.begintime BETWEEN #{beginTime} and #{endTime}
        <if test="shiftid!=-1">
            AND a.shiftid=#{shiftid}
        </if>
        ORDER BY a.begintime DESC
        limit ${offset},${pageNums}
    </select>
    <select id="getUserMapList" resultType="map">
        SELECT
        a.job_number,
        b.name
        FROM t_b_employee a
        LEFT JOIN t_branch_info c
        ON a.branch_id = c.branchid
        LEFT JOIN t_b_user b
        ON a.user_id = b.id
    </select>
</mapper>