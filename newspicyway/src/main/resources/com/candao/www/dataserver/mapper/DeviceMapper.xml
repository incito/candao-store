<?xml version="1.0" encoding="UTF-8" ?>

<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.candao.www.dataserver.mapper.DeviceMapper">
    <resultMap id="BaseResultMap" type="com.candao.www.dataserver.entity.Device">
        <result column="id" property="id"/>
        <result column="device_group" property="deviceGroup"/>
        <result column="device_id" property="deviceId"/>
        <result column="device_type" property="deviceType"/>
        <result column="ss_id" property="ssId"/>
        <result column="meid" property="meid"/>
        <result column="create_time" property="createTime"/>
        <result column="update_time" property="updateTime"/>
        <result column="valid_flag" property="validFlag"/>
    </resultMap>
    <insert id="save" useGeneratedKeys="true" keyProperty="id" parameterType="com.candao.www.dataserver.entity.Device">
        INSERT INTO t_device(device_group, device_id, device_type,ss_id,meid,create_time,update_time,valid_flag)
        VALUES (#{deviceGroup},#{deviceId},#{deviceType},#{ssId},#{meid},now(),now(), 1)
    </insert>
    <update id="update">
        update t_device set update_time=now()
        <if test="deviceType!=null">
            ,device_type=#{deviceType}
        </if>
        <if test="ssId!=null">
            ,ss_id=#{ssId}
        </if>
        <if test="meid!=null">
            ,meid=#{meid}
        </if>
        <if test="validFlag!=null">
            ,valid_flag=#{validFlag}
        </if>
        WHERE device_group=#{deviceGroup} and device_id=#{deviceId}
    </update>
    <select id="countByGroupAndId" resultType="java.lang.Integer">
        select count(1) from t_device where device_group=#{group} and device_id=#{id}
    </select>
    <select id="getByGroupAndId" resultMap="BaseResultMap">
        select * from t_device where device_group=#{group} and device_id=#{id}
    </select>
    <select id="getAllDevice" resultMap="BaseResultMap">
      SELECT * FROM t_device
    </select>
    <select id="getDeviceByMeId" resultMap="BaseResultMap">
        SELECT * FROM t_device WHERE meid=#{meid} ORDER BY update_time desc limit 1
    </select>
    <select id="getDeviceById" resultMap="BaseResultMap">
        SELECT * FROM t_device WHERE id=#{id}
    </select>
</mapper>
