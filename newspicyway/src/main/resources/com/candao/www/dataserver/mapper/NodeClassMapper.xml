<?xml version="1.0" encoding="UTF-8" ?>

<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.candao.www.dataserver.mapper.NodeClassMapper">
    <select id="getMaxClassNo" resultType="java.lang.String" parameterType="java.util.HashMap">
      select max(classno) from t_nodeclass
      <where>
          <trim prefixOverrides="and">
              <if test="posID != null and posID != '' ">
                  AND posID = #{posID}
              </if>
              <if test="operatorID != null and operatorID != ''">
                  AND operatorID = #{operatorID}
              </if>
          </trim>
      </where>
    </select>
    <select id="getMaxClassNoToday" resultType="java.lang.String" parameterType="String">
        select max(classno) from t_nodeclass where classno like '${preStr}%'
    </select>
    <select id="getNodeClassByNo" resultType="java.util.HashMap">
       SELECT *,#{tipTotalAmount} AS tipTotalAmount FROM t_nodeclass WHERE  classno=#{jsOrder}
    </select>
    <select id="getTipTotalAmountByClassNo" resultType="java.lang.Integer">
        SELECT
        SUM(t.paid) AS tipTotalAmount
        FROM t_nodeclass n
        LEFT JOIN t_b_tip t
        ON (t.insertime > n.vIn
        AND t.insertime &lt; n.vOut)
        WHERE classno =#{jsOrder}
    </select>
    <select id="getJsListJsonByNo" resultType="java.util.HashMap">
        SELECT b.itemid,b.itemDesc,sum(a.payamount) as payamount
        FROM t_nodeclass_detail a
        RIGHT JOIN v_revenuepayway b on a.payway=b.itemid
        where   a.classno=#{jsOrder} AND a.payamount!=0
        GROUP BY b.itemid
    </select>
    <insert id="insert" parameterType="map">
         INSERT INTO t_nodeclass (classNo, posID, operatorID, operatorName, vIn, vOut, prettyCash, lastNonTable, lastNonDeposit, tBeginPeople, tBeginTableTotal, tNonClosingTable, tNonClosingMoney, tNonClosingDeposit, tClosingTable, tClosingPeople, tPresentedMoney, tRFoodMoney, itemMoney, serviceMoney, roomMoney, lowConsComp, preferenceMoney, accountsReceivableSubtotal, removeMoney, ratedPreferenceMoney, accountsReceivableTotal, includedMoneyTotal, noIncludedMoneyTotal, TotalMoney, tableware, drinks, drinksSmokeNoodle, todayTurnover, priterTime,ipaddress,workdate,shiftid,authorizer,preferenceDetail)
        VALUES (#{classNo}, #{posID}, #{operatorID}, #{operatorName}, #{vIn}, #{vOut}, #{prettyCash}, #{lastNonTable}, #{lastNonDeposit}, #{tBeginPeople}, #{tBeginTableTotal}, #{tNonClosingTable}, #{tNonClosingMoney}, #{tNonClosingDeposit}, #{tClosingTable}, #{tClosingPeople}, #{tPresentedMoney}, #{tRFoodMoney}, #{itemMoney}, #{serviceMoney}, #{roomMoney}, #{lowConsComp}, #{preferenceMoney}, #{accountsReceivableSubtotal}, #{removeMoney}, #{ratedPreferenceMoney}, #{accountsReceivableTotal}, #{includedMoneyTotal}, #{noIncludedMoneyTotal}, #{TotalMoney}, #{tableware}, #{drinks},
        #{drinksSmokeNoodle}, #{todayTurnover}, #{priterTime},#{ipaddress},#{workdate},#{shiftid},#{authorizer},#{preferenceDetail})

    </insert>
</mapper>
